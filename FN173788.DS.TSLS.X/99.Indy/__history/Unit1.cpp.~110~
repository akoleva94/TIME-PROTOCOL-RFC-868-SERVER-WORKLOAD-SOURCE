//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "Unit1.h"
#include "System.SysUtils.hpp"
#include "System.Classes.hpp"
#include "System.SysUtils.hpp"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
TDateTime Server1Execute(TIdContext *AContext, TDateTime t)
{
	try
	{
		t = AContext->ToString();
		TStrings *s;
		s = String.Format(t); //t.ToString("MM'/'dd'/'yyyy HH':'mm':'ss.fff");
		//s = DateTimeToStr(t);
		AContext->Connection->WriteRFCStrings(s);
		//AContext->Connection->WriteRFCStrings(t.DateTimeString());
		//AContext->Connection->WriteRFCStrings(ToString(t));
		//t = AThread->Connection->ReadLn();
	   	//AThread->Connection->WriteLn(t);

	}

	catch(...)
	{
		AContext->Connection->Disconnect();
	}

    return(t);
}

//---------------------------------------------------------------------------
void __fastcall TForm1::btnActivateClick(TObject *Sender)
{
	IdDayTimeServer1->Active = true;
}
//---------------------------------------------------------------------------
void __fastcall TForm1::btnDeactivateClick(TObject *Sender)
{
	IdDayTimeServer1->Destroying();
}
//---------------------------------------------------------------------------
//void __fastcall TForm1::IdDayTimeServer1Execute(TIdPeerThread *AThread)
//{
//	TDateTime t;
////	editClientMsg->Text = Server1Execute(AThread, t);
////	editSentMsg->Text = Server1Execute(AThread, t);
//}
//---------------------------------------------------------------------------
//void __fastcall TForm1::IdDayTimeServer1Status(TObject *ASender, const TIdStatus AStatus,
//          const UnicodeString AStatusText)
//{
//	if (AStatus == hsConnected)
//	{
//
//    }
//    TDateTime t;
//	editClientMsg->Text = Server1Execute(AThread, t);
//	editSentMsg->Text = Server1Execute(AThread, t);
//}
//---------------------------------------------------------------------------
void __fastcall TForm1::IdDayTimeServer1Connect(TIdContext *AContext)
{
	TDateTime t;
	editClientMsg->Text = Server1Execute(AContext, t);
	editSentMsg->Text = Server1Execute(AContext, t);
}
//---------------------------------------------------------------------------
